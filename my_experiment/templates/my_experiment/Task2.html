{% extends "global/Page.html" %}
{% block content %}
    <div class="container py-4 px-3 bg-white border rounded shadow-sm">
        {% if language == 'it' %}
            <h3 class="text-center text-primary fw-semibold mb-4">Scelta Intertemporale</h3>
            <p class="fs-5 fw-semibold text-center">Hai un budget di €1.000 <strong>per ognuna delle 5 decisioni</strong>. Distribuiscilo tra il presente e il futuro.</p>
        {% else %}
            <h3 class="text-center text-primary fw-semibold mb-4">Intertemporal Choice</h3>
            <p class="fs-5 fw-semibold text-center">You have a budget of €1,000 <strong>for each of the 5 decisions</strong>. Allocate this amount between right now and 4 weeks from now.</p>
        {% endif %}
        <hr>

        {% for rate, fmt in rate_pairs %}
            <hr>
            <div class="mb-4 p-3 bg-light border rounded">
                <p class="fs-5 text-center">
                    <strong>
                        {% if language == 'it' %}
                            Decisione {{ forloop.counter }}
                            (Tasso: {{ fmt }}×)
                        {% else %}
                            Decision {{ forloop.counter }}
                            (Rate: {{ fmt }}×)
                        {% endif %}
                    </strong>
                </p>

                <div class="row align-items-center">
                    <div class="col-md-6">
                        <div class="form-group border border-primary rounded p-3 bg-light shadow-sm text-center">
                            <label class="fs-5 mb-2" for="alloc_early{{ forloop.counter }}">
                                {% if language == 'it' %}Immediatamente:{% else %}Right Now:{% endif %}
                            </label>
                            <input
                                id="alloc_early{{ forloop.counter }}"
                                type="number"
                                name="alloc_early{{ forloop.counter }}"
                                class="form-control form-control-lg"
                                step="0.01"
                                min="0"
                                max="1000"
                                required
                            >
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group border border-primary rounded p-3 bg-light shadow-sm text-center">
                            <label class="fs-5 mb-2" for="alloc_late{{ forloop.counter }}">
                                {% if language == 'it' %}Tra 4 settimane:{% else %}4 weeks:{% endif %}
                            </label>
                            <input
                                id="alloc_late{{ forloop.counter }}"
                                type="number"
                                name="alloc_late{{ forloop.counter }}"
                                class="form-control form-control-lg"
                                step="0.01"
                                min="0"
                                max="1000"
                                required
                            >
                        </div>
                    </div>
                </div>
            </div>
        {% endfor %}

        <div class="d-flex justify-content-end">
            <button type="submit" class="btn btn-primary btn-lg mt-4 shadow otree-btn-next">
                {% if language == 'it' %}Avanti{% else %}Next{% endif %}
            </button>
        </div>

        <script>
            const budget = 1000.0;

            document.addEventListener('DOMContentLoaded', () => {
                for (let i = 1; i <= 5; i++) {
                    const early = document.querySelector(`input[name="alloc_early${i}"]`);
                    const late = document.querySelector(`input[name="alloc_late${i}"]`);

                    if (early && late) {
                        early.addEventListener('input', () => {
                            let eVal = parseFloat(early.value);
                            if (!isNaN(eVal) && eVal >= 0 && eVal <= budget) {
                                late.value = (budget - eVal).toFixed(2);
                            }
                        });

                        late.addEventListener('input', () => {
                            let lVal = parseFloat(late.value);
                            if (!isNaN(lVal) && lVal >= 0 && lVal <= budget) {
                                early.value = (budget - lVal).toFixed(2);
                            }
                        });
                    }
                }
            });
        </script>
    </div>
{% endblock %}